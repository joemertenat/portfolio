<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Portfolio — Simplified Slides</title>

  <!-- Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&display=swap" rel="stylesheet"/>


  <style>
    :root{
      --bg: #0f1012;
      --ink: #0a0a0a;
      --panelBorder: rgba(0,0,0,0.12);

      --titleColor: #000000;

      --indexOverlayBg: rgba(0,0,0,0.55);
      --indexPanelBg: #ffffff;
      --indexPanelText: #000000;
      --indexPanelSub: #6b6b6b;

      --indexItemBg: #ffffff;
      --indexItemBorder: rgba(0,0,0,0.12);
      --indexItemText: #000000;
      --indexItemBgHover: #3a3a3a;
      --indexItemTextHover: #ffffff;
      --indexItemBorderHover: rgba(0,0,0,0);

      --ctaBg: rgba(255,255,255,1);
      --ctaText: #000000;
      --ctaBorder: rgba(0,0,0,0.15);
      --ctaBgHover: #e0e0e0;
      --ctaTextHover: #000000;

      --indexBtnBg: #ffffff;
      --indexBtnText: #000000;
      --indexBtnBorder: rgba(0,0,0,0.15);
      --indexBtnBgHover: #dcdcdc;
      --indexBtnTextHover: #000000;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    html { scroll-behavior: smooth; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      overflow: hidden; /* we scroll inside .scroller */
      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-weight: 400;
    }

    .hud { display: none !important; }

    /* SCROLLER: full-viewport pages with snap */
    .scroller {
      height: 100dvh;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
    }

    .slide {
      position: relative;
      min-height: 100dvh;
      width: 100%;
      background: #fafafa;
      color: #000000;
      scroll-snap-align: start;
      isolation: isolate;

      display: flex;
      align-items: center;
      justify-content: center;

      overflow: hidden;
    }

    .stage {
      position: relative;
      width: 100vw;
      height: 100dvh;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
    }

    .stage img,
    .stage video {
      width: 110%;
      height: 110%;
      max-width: 110vw;
      max-height: 110dvh;
      object-fit: contain;
      object-position: center;
      display: block;
    }

    .video-wrapper {
      width: 100vw;
      height: 100dvh;

      display: flex;
      align-items: center;
      justify-content: center;

      max-height: 90dvh;
      max-width: 100vw;
      transform: translateY(5vh);
    }
    .video-wrapper video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center;
      max-width: 100%;
      max-height: 100%;
      display: block;
    }

    /* Top-left title block */
    .slide-title {
      position: absolute;
      top: 2rem;
      left: 2rem;
      z-index: 20;

      max-width: 80ch;
      pointer-events: none;
      white-space: pre-line;

      color: var(--titleColor);
      background: transparent;
      border: none;
      padding: 0;
    }
    .slide-title .title-main {
      display: block;
      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-weight: 500;
      font-size: 16px;
      line-height: 1.3;
      color: var(--titleColor);
    }
    .slide-title .title-sub {
      display: block;
      margin-top: .5rem;
      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-weight: 400;
      font-size: 16px;
      line-height: 1.3;
      color: var(--titleColor);
      white-space: pre-line;
    }

    /* CTA / HUD BUTTONS BASE STYLE */
    .cta-btn,
    .index-btn,
    .contact-btn {
      appearance: none;
      -webkit-appearance: none;

      border-radius: 999px;
      cursor: none;
      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 14px;
      font-weight: 500;
      line-height: 1.2;
      padding: .6rem 1rem;
      text-align: center;
      box-shadow: 0 8px 30px rgba(0,0,0,.15);

      border: 1px solid var(--ctaBorder);
      background: var(--ctaBg);
      color: var(--ctaText);

      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease, background-color .15s ease, box-shadow .15s ease;
      z-index: 40;
    }

    /* bottom CTA variation */
    .cta-btn {
      position: absolute;
      bottom: 2.5rem;
      left: 50%;
      transform: translateX(-50%);
      min-width: 140px;
    }

    /* top-right Index */
    .index-btn {
      position: absolute;
      top: 1rem;
      right: 7rem;

      background: var(--indexBtnBg);
      border: 1px solid var(--indexBtnBorder);
      color: var(--indexBtnText);
      min-width: auto;
      padding: .5rem .8rem;
      font-size: 13px;
      font-weight: 500;
      line-height: 1.2;
      box-shadow: 0 6px 20px rgba(0,0,0,.15);
    }

    /* top-right Contact (sits to the RIGHT of Index visually using translate) */
    .contact-btn {
      position: absolute;
      top: 1rem;
      right: 6rem;

      background: var(--indexBtnBg);
      border: 1px solid var(--indexBtnBorder);
      color: var(--indexBtnText);
      min-width: auto;
      padding: .5rem .8rem;
      font-size: 13px;
      font-weight: 500;
      line-height: 1.2;
      box-shadow: 0 6px 20px rgba(0,0,0,.15);

      /* push it a bit further right than the Index button */
      transform: translateX(4.5rem);
    }

    /* hover states */
    .cta-btn:hover,
    .cta-btn:focus-visible {
      outline: none;
      background: var(--ctaBgHover);
      color: var(--ctaTextHover);
      box-shadow: 0 10px 36px rgba(0,0,0,.22);
    }

    .index-btn:hover,
    .index-btn:focus-visible,
    .contact-btn:hover,
    .contact-btn:focus-visible {
      outline: none;
      background: var(--indexBtnBgHover);
      color: var(--indexBtnTextHover);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    /* CUSTOM CURSOR */
    .scroller, .scroller * { cursor: none !important; }
    html, body, #scroller, #scroller *, .slide, .slide *, .stage, .stage *, .hud, .hud * {
      cursor: none !important;
    }

    .cursor {
      position: fixed;
      left: 0;
      top: 0;
      width: 40px;
      height: 40px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 2000;
      opacity: 0;
      transition: opacity .15s ease;
    }
    .cursor .dot{
      display:block;
      width:100%;
      height:100%;
      border-radius: 999px;
      background: rgba(200,200,200,.38);
      transition: background .12s ease, transform .14s ease;
    }
    .cursor.visible { opacity: 0.9; }
    .cursor.solid .dot { background: #000000; }

    /* SCROLLBAR aesthetic */
    .scroller::-webkit-scrollbar{ width: 10px; }
    .scroller::-webkit-scrollbar-thumb{
      background: #2a2c31;
      border-radius: 999px;
    }

    /* INDEX OVERLAY */
    .index-overlay {
      position: fixed;
      inset: 0;
      z-index: 1500;
      background: var(--indexOverlayBg);
      backdrop-filter: blur(50px);
      -webkit-backdrop-filter: blur(50px);

      display: none;
      align-items: center;
      justify-content: center;
      padding: 4vh 4vw;
    }

    .index-panel {
      background: var(--indexPanelBg);
      color: var(--indexPanelText);
      border: 1px solid var(--panelBorder);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      min-width: min(320px, 90vw);
      max-width: min(420px, 90vw);
      max-height: 80vh;
      overflow-y: auto;
      padding: 20px 24px;
      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .index-header {
      font-size: 16px;
      font-weight: 500;
      line-height: 1.2;
      color: var(--indexPanelText);
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }
    .index-close-hint {
      font-size: 12px;
      font-weight: 400;
      color: var(--indexPanelSub);
    }

    .index-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .index-section-title {
      font-size: 14px;
      font-weight: 500;
      line-height: 1.2;
      color: #000000;
      margin: 16px 0 8px 0;
    }

    .index-list-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .index-item-btn {
      appearance: none;
      -webkit-appearance: none;
      width: 100%;
      text-align: left;
      font-size: 14px;
      line-height: 1.3;
      font-weight: 500;
      font-family: inherit;
      background: var(--indexItemBg);
      color: #333333;
      border: 1px solid var(--indexItemBorder);
      border-radius: 12px;
      padding: 10px 12px;
      cursor: none;
      transition:
        background-color .15s ease,
        box-shadow .15s ease,
        color .15s ease,
        border-color .15s ease;
      display: block;
    }

    .index-item-btn .index-title {
      font-size: 14px;
      font-weight: 500;
      color: #787878;
      line-height: 1.3;
    }

    .index-item-btn:hover,
    .index-item-btn:focus-visible {
      outline: none;
      background: var(--indexItemBgHover);
      color: #ffffff;
      border-color: var(--indexItemBorderHover);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .index-item-btn.is-active {
      background: var(--indexItemBgHover);
      color: #ffffff;
      border-color: var(--indexItemBorderHover);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    /* bottom-left block on last slide */
    .contact-block {
      position: absolute;
      bottom: 2rem;
      left: 2rem;
      z-index: 50;

      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 25px;
      font-weight: 400;
      line-height: 1.3;
      color: #CFCFCF;
      white-space: pre-line;
      pointer-events: none;
    }

    .cv-link {
      position: absolute;
      left: 2rem;
      bottom: 250px;
      z-index: 50;

      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 25px;
      font-weight: 400;
      line-height: 1.3;
      color: #CFCFCF;

      background: transparent;
      border: none;
      padding: 0;
      margin: 0;

      text-decoration: underline;
      cursor: none;

      transition: color .15s ease;
    }

    .cv-link:hover,
    .cv-link:focus-visible {
      color: #ffffff;
      outline: none;
    }

    @media (hover: none), (pointer: coarse) {
      .cursor { display: none !important; }
    }
  </style>
</head>

<body>
  <div class="hud">
    Scroll / PgUp / PgDn — title stays in top-left per project
  </div>

  <!-- custom cursor -->
  <div id="cursor" class="cursor" aria-hidden="true">
    <span class="dot"></span>
  </div>

  <!-- Main scroller -->
  <main id="scroller" class="scroller" aria-label="Portfolio slides"></main>

  <!-- INDEX OVERLAY -->
  <div id="indexOverlay" class="index-overlay" aria-hidden="true">
    <div class="index-panel" role="dialog" aria-modal="true" aria-label="Index">
      <div class="index-header">
        <div>Index</div>
        <div class="index-close-hint">click outside or Esc to close</div>
      </div>
      <div id="indexList" class="index-list"></div>
    </div>
  </div>

  <script>
    /**
     * PROJECT GROUPS FOR INDEX
     */
    const projects = [
      {
        heading: "Project 1: Architecture Studio Archive",
        indices: [2, 3, 4, 5, 6, 7]
      },
      {
        heading: "Project 2: Business Management App",
        indices: [8, 9, 10, 11, 12, 13]
      },
      {
        heading: "Project 3: Sentiment Dashboard",
        indices: [14, 15, 16, 17, 18, 19, 20]
      },
      {
        heading: "Project 4: Interactive Infographics (Housing Module)",
        indices: [21, 22, 23, 24, 25, 26]
      }
    ];

    /**
     * SLIDE CONFIG
     */
    const slides = [
      {
        type: 'image',
        src: 'assets/svg/A_Title.svg',
        showTitle: false,
        title: 'Who am I?',
        label: 'Intro',
        ctaType: 'discover'
      },
      {
        type: 'image',
        src: 'assets/svg/A_Intro.svg',
        showTitle: false,
        title: 'My expertise and skills',
        label: 'Intro',
        ctaType: 'discover2'
      },
      {
        type: 'image',
        src: 'assets/svg/B1.1_Project1_TiltePage.svg',
        showTitle: false,
        title: 'Information',
        label: 'Project 1: Architecture Studio Archive'
      },
      {
        type: 'image',
        src: 'assets/svg/B1.2_Project1_ProblemFraming.svg',
        showTitle: false,
        title: 'Problem Framing',
        label: 'Project 1: Architecture Studio Archive',
        ctaType: 'see-project'
      },

      // PNG details Project 1
      {
        type: 'image',
        src: 'assets/png/project1_nav.svg',
        showTitle: true,
        title: 'Focused user flow – search process',
        label: 'Project 1: Architecture Studio Archive'
      },
      {
        type: 'image',
        src: 'assets/png/project1_wireframe.svg',
        showTitle: true,
        title: 'Focused wireframe — search process',
        label: 'Project 1: Architecture Studio Archive'
      },
      {
        type: 'video',
        src: 'assets/video/project1_video1.mp4',
        showTitle: true,
        title: '“How to make time navigable, not just visible”',
        label: 'Project 1: Architecture Studio Archive'
      },
      {
        type: 'video',
        src: 'assets/video/project1_video2.mp4',
        showTitle: true,
        title: '“Creating multiple entry points without losing cohesion”',
        label: 'Project 1: Architecture Studio Archive'
      },

      {
        type: 'image',
        src: 'assets/svg/B2.1_Project2_TitlePage.svg',
        showTitle: false,
        title: 'Information',
        label: 'Project 2: Business Management App'
      },
      {
        type: 'image',
        src: 'assets/svg/B2.2_Project2_ProblemFraming.svg',
        showTitle: false,
        title: 'Problem Framing',
        label: 'Project 2: Business Management App',
        ctaType: 'see-project'
      },

      // PNG details Project 2
      {
        type: 'image',
        src: 'assets/png/project2_nav.svg',
        showTitle: true,
        title: 'Focused user flow – task management',
        label: 'Project 2: Business Management App'
      },
      {
        type: 'image',
        src: 'assets/png/project2_wireframe.svg',
        showTitle: true,
        title: 'Focused wireframe - task management',
        label: 'Project 2: Business Management App'
      },

      {
        type: 'image',
        src: 'assets/svg/B2.3Project2_Approach1.svg',
        showTitle: true,
        title: '“Simplify complexity without losing functionality”',
        label: 'Project 2: Business Management App'
      },
      {
        type: 'video',
        src: 'assets/video/project2_video1.mp4',
        showTitle: true,
        title: '“Design for low digital literacy”',
        label: 'Project 2: Business Management App'
      },

      {
        type: 'image',
        src: 'assets/svg/B3.1_Project3_TitlePage.svg',
        showTitle: false,
        title: 'Information',
        label: 'Project 3: Sentiment Dashboard'
      },
      {
        type: 'image',
        src: 'assets/svg/B3.2_Project3_ProblemFraming.svg',
        showTitle: false,
        title: 'Problem Framing',
        label: 'Project 3: Sentiment Dashboard',
        ctaType: 'see-project'
      },

      // PNG details Project 3
      {
        type: 'image',
        src: 'assets/png/project3_nav.svg',
        showTitle: true,
        title: 'Focused user flow - overview to detail',
        label: 'Project 3: Sentiment Dashboard'
      },
      {
        type: 'image',
        src: 'assets/png/project3_wireframe.svg',
        showTitle: true,
        title: 'Focused wireframe – overview to detail',
        label: 'Project 3: Sentiment Dashboard'
      },

      {
        type: 'video',
        src: 'assets/video/project3_video1.mp4',
        showTitle: true,
        title: '“Designing interactivity as inquiry”',
        label: 'Project 3: Sentiment Dashboard'
      },
      {
        type: 'video',
        src: 'assets/video/project3_video3.mp4',
        showTitle: true,
        title: '“Enabling critical comparison between algorithmic interpretations”',
        label: 'Project 3: Sentiment Dashboard'
      },
      {
        type: 'video',
        src: 'assets/video/project3_video2.mp4',
        showTitle: true,
        title: '“Guiding interpretation through interface”',
        label: 'Project 3: Sentiment Dashboard'
      },

      {
        type: 'image',
        src: 'assets/svg/B4.1_Project4_TitlePage.svg',
        showTitle: false,
        title: 'Information',
        label: 'Project 4: Interactive Infographics (Housing Module)'
      },
      {
        type: 'image',
        src: 'assets/svg/B4.2_Project4_ProblemFraming.svg',
        showTitle: false,
        title: 'Problem Framing',
        label: 'Project 4: Interactive Infographics (Housing Module)',
        ctaType: 'see-project'
      },

      // PNG details Project 4
      {
        type: 'image',
        src: 'assets/png/project4_nav.svg',
        showTitle: true,
        title: 'Focused user flow – micro macro navigaion',
        label: 'Project 4: Interactive Infographics (Housing Module)'
      },
      {
        type: 'image',
        src: 'assets/png/project4_wireframe.svg',
        showTitle: true,
        title: 'Focused wireframe – micro macro navigaion',
        label: 'Project 4: Interactive Infographics (Housing Module)'
      },

      {
        type: 'video',
        src: 'assets/video/project4_video1.mp4',
        showTitle: true,
        title: '“Balancing minimalism with informational depth”',
        label: 'Project 4: Interactive Infographics (Housing Module)'
      },
      {
        type: 'video',
        src: 'assets/video/project4_video2.mp4',
        showTitle: true,
        title: '“Using interaction to support understanding”',
        label: 'Project 4: Interactive Infographics (Housing Module)'
      },

      // END / CONTACT PAGE
      {
        type: 'image',
        src: 'assets/svg/C_EndPage.svg',
        showTitle: false,
        title: '',
        label: 'End'
      }
    ];

    const scroller = document.getElementById('scroller');
    const indexOverlay = document.getElementById('indexOverlay');
    const indexList = document.getElementById('indexList');
    const cursor = document.getElementById('cursor');

    let cursorVisible = false;
    const rendered = []; // [{ slide }]
    let lastNonContactSlide = null; // will store index before jumping to contact

    // Build the slide title block
    function buildTitleNode(rawTitle){
      const box = document.createElement('div');
      box.className = 'slide-title';

      const parts = rawTitle.split('\n');
      const mainLine = parts.shift() || '';
      const rest = parts.join('\n');

      const mainSpan = document.createElement('span');
      mainSpan.className = 'title-main';
      mainSpan.textContent = mainLine;
      box.appendChild(mainSpan);

      if (rest.trim() !== '') {
        const subSpan = document.createElement('span');
        subSpan.className = 'title-sub';
        subSpan.textContent = rest;
        box.appendChild(subSpan);
      }

      return box;
    }

    // Bottom CTA
    function buildCTAButton(slideIndex, ctaType){
      if (!ctaType) return null;
      let text = '';
      if (ctaType === 'discover') {
        text = 'Discover';
      } else if (ctaType === 'see-project') {
        text = 'See the project';
      } else if (ctaType === 'discover2') {
        text = 'Discover the projects';
      } else {
        return null;
      }

      const btn = document.createElement('button');
      btn.className = 'cta-btn';
      btn.type = 'button';
      btn.textContent = text;
      btn.setAttribute('data-jump-from', String(slideIndex));

      btn.addEventListener('pointerenter', () => {
        setCursorSolid(true);
      });
      btn.addEventListener('pointerleave', () => {
        setCursorSolid(false);
      });

      btn.addEventListener('click', () => {
        const slidesEl = Array.from(scroller.querySelectorAll('.slide'));
        const target = slidesEl[slideIndex + 1];
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });

      return btn;
    }

    // Top-right "Index" button
    function buildIndexButton(){
      const btn = document.createElement('button');
      btn.className = 'index-btn';
      btn.type = 'button';
      btn.textContent = 'Index';

      btn.addEventListener('pointerenter', () => {
        setCursorSolid(true);
      });
      btn.addEventListener('pointerleave', () => {
        setCursorSolid(false);
      });

      btn.addEventListener('click', openIndexOverlay);

      return btn;
    }

    // Top-right "Contact / Back" button
    function buildContactButton(slideIndex){
      const btn = document.createElement('button');
      btn.className = 'contact-btn';
      btn.type = 'button';
      btn.textContent = 'Contact';

      btn.addEventListener('pointerenter', () => {
        setCursorSolid(true);
      });
      btn.addEventListener('pointerleave', () => {
        setCursorSolid(false);
      });

      btn.addEventListener('click', () => {
        const slidesEl = Array.from(scroller.querySelectorAll('.slide'));
        const lastSlideEl = slidesEl[slides.length - 1];
        const currentIdx = getCurrentSlideIndex();

        // if we're already on the last slide AND text says "Back"
        if (btn.getAttribute('data-mode') === 'back') {
          // go back to saved slide
          if (lastNonContactSlide != null) {
            const backTarget = slidesEl[lastNonContactSlide];
            if (backTarget) {
              backTarget.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
          return;
        }

        // else: we're not in "back" mode yet, so save where we are and go to last slide
        lastNonContactSlide = currentIdx;
        if (lastSlideEl) {
          lastSlideEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });

      return btn;
    }

    // Render Slides
    slides.forEach((s, idx) => {
      const slide = document.createElement('section');
      slide.className = 'slide';
      slide.setAttribute('data-index', idx);

      const stage = document.createElement('figure');
      stage.className = 'stage';
      stage.style.margin = 0;

      // media
      if (s.type === 'video') {
        const wrapper = document.createElement('div');
        wrapper.className = 'video-wrapper';

        const vid = document.createElement('video');
        vid.src = s.src;
        vid.playsInline = true;
        vid.muted = true;
        vid.autoplay = true;
        vid.loop = true;

        wrapper.appendChild(vid);
        stage.appendChild(wrapper);
      } else {
        const img = new Image();
        img.src = s.src;
        img.alt = `Slide ${idx+1}`;
        img.loading = 'lazy';
        img.decoding = 'async';
        stage.appendChild(img);
      }

      // optional title block
      if (s.showTitle && s.title) {
        slide.appendChild(buildTitleNode(s.title));
      }

      // Bottom CTA
      const ctaBtn = buildCTAButton(idx, s.ctaType);
      if (ctaBtn) {
        slide.appendChild(ctaBtn);
      }

      // Top-right "Index"
      const idxBtn = buildIndexButton();
      slide.appendChild(idxBtn);

      // Top-right "Contact / Back"
      const contactBtn = buildContactButton(idx);
      slide.appendChild(contactBtn);

      // main media
      slide.appendChild(stage);

      // If last slide, add contact info + CV link
      if (idx === slides.length - 1) {
        const contact = document.createElement('div');
        contact.className = 'contact-block';
        contact.textContent =
          "Name: Joé Mertenat\n" +
          "Title: UX/UI & Information Designer\n" +
          "Email: joe.mertenat@bluewin.ch\n" +
          "Phone: +41 79 237 07 77\n" +
          "Location: Rue des Voignous 12, 2800 Delémont, Switzerland";
        slide.appendChild(contact);

        const cvLink = document.createElement('button');
        cvLink.type = 'button';
        cvLink.className = 'cv-link';
        cvLink.textContent = 'Download CV';

        cvLink.addEventListener('click', () => {
          window.open('assets/cv/Joe-Mertenat_CV.pdf', '_blank');
        });

        cvLink.addEventListener('pointerenter', () => {
          setCursorSolid(true);
        });
        cvLink.addEventListener('pointerleave', () => {
          setCursorSolid(false);
        });

        slide.appendChild(cvLink);
      }

      rendered.push({ slide });
      scroller.appendChild(slide);
    });

    // Build INDEX OVERLAY CONTENT (grouped by project)
    function buildIndexOverlayContents() {
      indexList.innerHTML = "";

      projects.forEach(group => {
        const sectionTitle = document.createElement('div');
        sectionTitle.className = 'index-section-title';
        sectionTitle.textContent = group.heading;
        indexList.appendChild(sectionTitle);

        const groupWrap = document.createElement('div');
        groupWrap.className = 'index-list-group';

        group.indices.forEach(i => {
          const slideConf = slides[i];

          const itemBtn = document.createElement('button');
          itemBtn.type = 'button';
          itemBtn.className = 'index-item-btn';
          itemBtn.setAttribute('data-goto', String(i));

          let mainTitle = '';
          if (slideConf.title && slideConf.title.trim() !== '') {
            mainTitle = slideConf.title.split('\n')[0];
          } else if (slideConf.label && slideConf.label.trim() !== '') {
            mainTitle = slideConf.label;
          } else {
            mainTitle = `Slide ${i+1}`;
          }

          const titleDiv = document.createElement('div');
          titleDiv.className = 'index-title';
          titleDiv.textContent = mainTitle;

          itemBtn.appendChild(titleDiv);

          itemBtn.addEventListener('pointerenter', () => {
            setCursorSolid(true);
          });
          itemBtn.addEventListener('pointerleave', () => {
            setCursorSolid(false);
          });

          itemBtn.addEventListener('click', () => {
            const slideEls = Array.from(scroller.querySelectorAll('.slide'));
            const target = slideEls[i];
            if (target) {
              closeIndexOverlay();
              target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });

          groupWrap.appendChild(itemBtn);
        });

        indexList.appendChild(groupWrap);
      });
    }

    buildIndexOverlayContents();

    // find current slide index
    function getCurrentSlideIndex() {
      const slidesEl = Array.from(document.querySelectorAll('.slide'));
      const midEl = document
        .elementFromPoint(window.innerWidth / 2, window.innerHeight / 2)
        ?.closest('.slide');
      return slidesEl.indexOf(midEl);
    }

    // highlight active page in Index
    function updateIndexHighlight() {
      const activeIdx = getCurrentSlideIndex();
      const allBtns = indexList.querySelectorAll('.index-item-btn');
      allBtns.forEach(btn => {
        const goto = parseInt(btn.getAttribute('data-goto'), 10);
        btn.classList.toggle('is-active', goto === activeIdx);
      });
    }

    // Overlay open/close
    function openIndexOverlay(){
      indexOverlay.style.display = 'flex';
      indexOverlay.setAttribute('aria-hidden','false');
      updateIndexHighlight(); // refresh highlight when opened
    }
    function closeIndexOverlay(){
      indexOverlay.style.display = 'none';
      indexOverlay.setAttribute('aria-hidden','true');
    }

    indexOverlay.addEventListener('click', (e) => {
      const panel = e.target.closest('.index-panel');
      if (!panel) {
        closeIndexOverlay();
      }
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeIndexOverlay();
      }
    });

    // CUSTOM CURSOR LOGIC
    function setCursorSolid(solid){
      if (!cursorVisible) return;
      cursor.classList.toggle('solid', !!solid);
    }
    function handlePointer(e){
      cursor.classList.add('visible');
      cursorVisible = true;

      const onHot =
        !!e.target.closest('.index-btn') ||
        !!e.target.closest('.contact-btn') ||
        !!e.target.closest('.cta-btn') ||
        !!e.target.closest('.index-item-btn') ||
        !!e.target.closest('.cv-link');

      cursor.classList.toggle('solid', onHot);
    }

    // cursor smoothing follow
    let px = 0, py = 0, tx = 0, ty = 0;
    const lerp = (a,b,t)=>a+(b-a)*t;
    function raf(){
      px = lerp(px, tx, 0.25);
      py = lerp(py, ty, 0.25);
      cursor.style.transform = `translate(${px - 20}px, ${py - 20}px)`;
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);

    window.addEventListener('pointermove', (e)=>{
      tx = e.clientX;
      ty = e.clientY;
      handlePointer(e);
    }, { passive: true });

    window.addEventListener('pointerleave', ()=>{
      cursor.classList.remove('visible','solid');
      cursorVisible = false;
    });

    // CONTACT BUTTON MODE (Contact vs Back)
    function updateContactButtonModes() {
      const currentIdx = getCurrentSlideIndex();
      const isOnLast = currentIdx === slides.length - 1;

      // loop over all slides and update their contact-btn text/mode
      const allSlides = document.querySelectorAll('.slide');
      allSlides.forEach(slideEl => {
        const contactBtn = slideEl.querySelector('.contact-btn');
        if (!contactBtn) return;

        if (isOnLast) {
          if (lastNonContactSlide != null) {
            contactBtn.textContent = 'Back';
            contactBtn.setAttribute('data-mode', 'back');
            contactBtn.style.opacity = '1';
            contactBtn.style.pointerEvents = 'auto';
          } else {
            contactBtn.style.opacity = '0';
            contactBtn.style.pointerEvents = 'none';
          }
        } else {
          contactBtn.textContent = 'Contact';
          contactBtn.setAttribute('data-mode', 'contact');
        }

      });
    }

    // BUTTON VISIBILITY BASED ON CURRENT SLIDE
    function updateButtonVisibility(){
      const idx = getCurrentSlideIndex();
      const slidesEl = Array.from(document.querySelectorAll('.slide'));

      slidesEl.forEach((slideEl, i) => {
        const cta = slideEl.querySelector('.cta-btn');
        const idxBtn = slideEl.querySelector('.index-btn');
        const contactBtn = slideEl.querySelector('.contact-btn');
        const active = (i === idx);

        if (cta){
          if (active){
            cta.style.opacity = '1';
            cta.style.pointerEvents = 'auto';
          } else {
            cta.style.opacity = '0';
            cta.style.pointerEvents = 'none';
          }
        }
        if (idxBtn){
          const isLast = (i === slides.length - 1);
          if (active && !isLast){
            idxBtn.style.opacity = '1';
            idxBtn.style.pointerEvents = 'auto';
          } else {
            idxBtn.style.opacity = '0';
            idxBtn.style.pointerEvents = 'none';
          }
        }

        if (contactBtn){
          if (active){
            contactBtn.style.opacity = '1';
            contactBtn.style.pointerEvents = 'auto';
          } else {
            contactBtn.style.opacity = '0';
            contactBtn.style.pointerEvents = 'none';
          }
        }
      });

      updateContactButtonModes();
    }

    // Scroll + resize update
    let ticking = false;
    function onScroll(){
      if (!ticking) {
        ticking = true;
        requestAnimationFrame(()=>{
          updateButtonVisibility();
          updateIndexHighlight();
          ticking = false;
        });
      }
    }
    scroller.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', () => {
      updateButtonVisibility();
      updateIndexHighlight();
    });

    // PAGEUP/PAGEDOWN nav
    window.addEventListener('keydown', e => {
      if (e.key !== 'PageDown' && e.key !== 'PageUp') return;
      e.preventDefault();
      const slidesEl = Array.from(document.querySelectorAll('.slide'));
      const current = document.elementFromPoint(
        window.innerWidth/2,
        window.innerHeight/2
      )?.closest('.slide');
      const i = slidesEl.indexOf(current);
      if (i < 0) return;
      const next = e.key === 'PageDown' ? slidesEl[i+1] : slidesEl[i-1];
      if (next) next.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    // Preload next images
    slides.slice(1).forEach(s => {
      if (s.type === 'image') {
        const i = new Image();
        i.src = s.src;
      }
    });




    // Initial state
    updateButtonVisibility();
    updateIndexHighlight();
  </script>
</body>
</html>
